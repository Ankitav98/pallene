/* This file was generated by the Titan compiler. Do not edit by hand */
/* Indentation and formatting courtesy of titan-compiler/pretty.lua */

#include <string.h>

#include "tcore.h"

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "lstring.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

static int function_ok_titan(
    lua_State * L,
    lua_Integer x1 /* x */,
    lua_Integer x2 /* y */,
    lua_Integer x3 /* z */
){
    CClosure * x4 = clCvalue(s2v(L->ci->func));
    Table * x5 /* upvalue table */ = hvalue(&x4->upvalue[0]);
    TValue * x6 /* upvalue array */ = x5->array;
    (void)x6;
    {
        lua_Integer x7 = intop(+, x1, x2);
        int x8 = x7 == x3;
        return x8;
    }
}

static int function_ok_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 3)) {
        titan_runtime_arity_error(L, 3, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttisinteger(x6))) {
        titan_runtime_argument_type_error(L, "x", 1, LUA_TNUMINT, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttisinteger(x7))) {
        titan_runtime_argument_type_error(L, "y", 1, LUA_TNUMINT, x7);
    }
    TValue* x8 = s2v(x4 + 3);
    if (TITAN_UNLIKELY(!ttisinteger(x8))) {
        titan_runtime_argument_type_error(L, "z", 1, LUA_TNUMINT, x8);
    }
    lua_Integer x9 = ivalue(s2v(x4 + 1));
    lua_Integer x10 = ivalue(s2v(x4 + 2));
    lua_Integer x11 = ivalue(s2v(x4 + 3));
    int x12 /* ret */ = function_ok_titan(L, x9, x10, x11);
    setbvalue(s2v(L->top), x12);
    api_incr_top(L);
    return 1;
}

static lua_Integer function_silly_titan(
    lua_State * L,
    Table * x1 /* xs */,
    Table * x2 /* ys */,
    Table * x3 /* zs */
){
    lua_checkstack(L, 3);
    CClosure * x4 = clCvalue(s2v(L->ci->func));
    Table * x5 /* upvalue table */ = hvalue(&x4->upvalue[0]);
    TValue * x6 /* upvalue array */ = x5->array;
    (void)x6;


    StackValue* frame = L->top;
    L->top += 3;
#define XS_SLOT s2v(frame+0)
#define YS_SLOT s2v(frame+1)
#define ZS_SLOT s2v(frame+2)

#define XS_VALUE hvalue(XS_SLOT)
#define YS_VALUE hvalue(YS_SLOT)
#define ZS_VALUE hvalue(ZS_SLOT)

    sethvalue(L, XS_SLOT, x1);
    sethvalue(L, YS_SLOT, x2);
    sethvalue(L, ZS_SLOT, x3);

    {
        lua_Integer x7 = luaH_getn(x1);
        lua_Integer x8 /* NI */ = x7;
        lua_Integer x9 = luaH_getn(x2);
        lua_Integer x10 /* NJ */ = x9;
        lua_Integer x11 = luaH_getn(x3);
        lua_Integer x12 /* NK */ = x11;
        lua_Integer x13 /* nsol */ = 0;
        lua_Integer x14 /* start */ = 1;
        lua_Integer x15 /* finish */ = x8;
        lua_Integer x16 /* inc */ = 1;
        while ((x16 >= 0 ? x14 <= x15 : x14 >= x15)) {
            lua_Integer x17 /* i */ = x14;
            (void) x17;
            {
                lua_Unsigned x18 /* ui */ = ((lua_Unsigned)x17) - 1;
                if (TITAN_UNLIKELY(x18 >= x1->sizearray)) {
                    titan_renormalize_array(L, x1, x18, 12);
                }
                const TValue * x19 /* arrslot */ = &x1->array[x18];
                if (TITAN_UNLIKELY(!ttisinteger(x19))) {
                    titan_runtime_array_type_error(L, 12, LUA_TNUMINT, rawtt(x19));
                }
                lua_Integer x20 = ivalue(x19);
                lua_Integer x21 /* x */ = x20;
                lua_Integer x22 /* start */ = 1;
                lua_Integer x23 /* finish */ = x10;
                lua_Integer x24 /* inc */ = 1;
                while ((x24 >= 0 ? x22 <= x23 : x22 >= x23)) {
                    lua_Integer x25 /* j */ = x22;
                    (void) x25;
                    {
                        lua_Unsigned x26 /* ui */ = ((lua_Unsigned)x25) - 1;
                        if (TITAN_UNLIKELY(x26 >= x2->sizearray)) {
                            titan_renormalize_array(L, x2, x26, 14);
                        }
                        const TValue * x27 /* arrslot */ = &x2->array[x26];
                        if (TITAN_UNLIKELY(!ttisinteger(x27))) {
                            titan_runtime_array_type_error(L, 14, LUA_TNUMINT, rawtt(x27));
                        }
                        lua_Integer x28 = ivalue(x27);
                        lua_Integer x29 /* y */ = x28;
                        lua_Integer x30 /* start */ = 1;
                        lua_Integer x31 /* finish */ = x12;
                        lua_Integer x32 /* inc */ = 1;
                        while ((x32 >= 0 ? x30 <= x31 : x30 >= x31)) {
                            lua_Integer x33 /* k */ = x30;
                            (void) x33;
                            {
                                lua_Unsigned x34 /* ui */ = ((lua_Unsigned)x33) - 1;
                                if (TITAN_UNLIKELY(x34 >= x3->sizearray)) {
                                    titan_renormalize_array(L, x3, x34, 16);
                                }
                                const TValue * x35 /* arrslot */ = &x3->array[x34];
                                if (TITAN_UNLIKELY(!ttisinteger(x35))) {
                                    titan_runtime_array_type_error(L, 16, LUA_TNUMINT, rawtt(x35));
                                }
                                lua_Integer x36 = ivalue(x35);
                                lua_Integer x37 /* z */ = x36;
                                {
                                    int x39 = function_ok_titan(L, x21, x29, x37);
                                    if (x39) {
                                        lua_Integer x40 = intop(+, x13, 1);
                                        x13 = x40;
                                    }
                                }
                            }
                            x30 = intop(+, x30, x32);
                        }
                    }
                    x22 = intop(+, x22, x24);
                }
            }
            x14 = intop(+, x14, x16);
        }

        L->top -= 3;
        return x13;
    }
}

static int function_silly_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 3)) {
        titan_runtime_arity_error(L, 3, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttistable(x6))) {
        titan_runtime_argument_type_error(L, "xs", 5, LUA_TTABLE, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttistable(x7))) {
        titan_runtime_argument_type_error(L, "ys", 5, LUA_TTABLE, x7);
    }
    TValue* x8 = s2v(x4 + 3);
    if (TITAN_UNLIKELY(!ttistable(x8))) {
        titan_runtime_argument_type_error(L, "zs", 5, LUA_TTABLE, x8);
    }
    Table * x9 = hvalue(s2v(x4 + 1));
    Table * x10 = hvalue(s2v(x4 + 2));
    Table * x11 = hvalue(s2v(x4 + 3));
    lua_Integer x12 /* ret */ = function_silly_titan(L, x9, x10, x11);
    setivalue(s2v(L->top), x12);
    api_incr_top(L);
    return 1;
}

int luaopen_benchmarks_sillybench_saveearly(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Table * x1 = luaH_new(L);
    luaH_resizearray(L, x1, 4);
    TValue * x2 = x1->array;
    /* Initialize upvalues */
    /* ------------------- */
    TString * x3 = luaS_new(L, "__index");
    setsvalue(L,  &x2[0] , x3);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x3))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x4 = luaS_new(L, "__metatable");
    setsvalue(L,  &x2[1] , x4);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* ok */
    CClosure* x5 = luaF_newCclosure(L, 1);
    x5->f = function_ok_lua;
    sethvalue(L, &x5->upvalue[0], x1);
    TValue x6; setclCvalue(L, &x6, x5);
    setobj(L,  &x2[2] , &x6);
    if (iscollectable(&x6) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x6))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* silly */
    CClosure* x7 = luaF_newCclosure(L, 1);
    x7->f = function_silly_lua;
    sethvalue(L, &x7->upvalue[0], x1);
    TValue x8; setclCvalue(L, &x8, x7);
    setobj(L,  &x2[3] , &x8);
    if (iscollectable(&x8) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x8))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table */
    /* -------------------- */
    StackValue* x9 = L->top;
    sethvalue(L, s2v(x9), x1); x9++;
    L->top = x9;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "silly");
    setobj(L, s2v(L->top),  &x2[3] ); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

