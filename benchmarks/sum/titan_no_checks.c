/* This file was generated by the Titan compiler. Do not edit by hand */
/* Indentation and formatting courtesy of titan-compiler/pretty.lua */

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

/* This pragma is used to ignore noisy warnings caused by clang's -Wall */
#ifdef __clang__
#pragma clang diagnostic ignored "-Wparentheses-equality"
#endif

static lua_Number function_sum_titan(
    lua_State * L,
    Table * x1 /* arr */,
    lua_Integer x2 /* n */
){
    lua_checkstack(L, 0);
    {
        lua_Number x3 /* s */ = 0x0p+0 /*0.000000*/;
        lua_Integer x4 /* start */ = 1;
        lua_Integer x5 /* finish */ = x2;
        lua_Integer x6 /* inc */ = 1;

	/* !!! move getn out of the loop */
        lua_Integer x9 = luaH_getn(x1);

        while ((x6 >= 0 ? x4 <= x5 : x4 >= x5)) {
            lua_Integer x7 /* i */ = x4;
            (void) x7;
            {
                lua_Integer x8 /* start */ = 1;
                lua_Integer x10 /* finish */ = x9;
                lua_Integer x11 /* inc */ = 1;
                while ((x11 >= 0 ? x8 <= x10 : x8 >= x10)) {
                    lua_Integer x12 /* i */ = x8;
                    (void) x12;
                    {
                        lua_Unsigned x13 /* ui */ = ((lua_Unsigned)x12) - 1;
                        TValue * x14 /* slot */ = &x1->array[x13];
                        x3 = ((x3)+(fltvalue(x14)));
                    }
                    x8 = intop(+, x8, x11);
                }
            }
            x4 = intop(+, x4, x6);
        }
        return x3;
    }
}

static int function_sum_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    StackValue* x1 = L->ci->func;
    int x2 /* nargs */ = cast_int(L->top - (x1 + 1));
    if (x2 != 2) {
        luaL_error(L,
        "wrong number of arguments to function, "
        "expected %d but received %d",
        2, x2);
    }
    TValue* x3 = s2v(x1 + 1);
    if (!ttistable(x3)) {
        luaL_error(L,
        "wrong type for argument %s at line %d, "
        "expected %s but found %s",
        "arr", 2, "{ float }",
        lua_typename(L, ttype(x3)));
    }
    TValue* x4 = s2v(x1 + 2);
    if (!ttisinteger(x4)) {
        luaL_error(L,
        "wrong type for argument %s at line %d, "
        "expected %s but found %s",
        "n", 2, "integer",
        lua_typename(L, ttype(x4)));
    }
    Table * x5 = hvalue(s2v(x1 + 1));
    lua_Integer x6 = ivalue(s2v(x1 + 2));
    lua_Number x7 /* ret */ = function_sum_titan(L, x5, x6);
    setfltvalue(s2v(L->top), x7);
    api_incr_top(L);
    return 1;
}

int luaopen_benchmarks_sum_titan_no_checks(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Table * x1 = luaH_new(L);
    luaH_resizearray(L, x1, 1);
    TValue * x2 = x1->array;
    /* Initialize module var upvalues */
    /* ------------------------------ */
    /* sum */
    CClosure* x3 = luaF_newCclosure(L, 1);
    x3->f = function_sum_lua;
    sethvalue(L, &x3->upvalue[0], x1);
    TValue x4; setclCvalue(L, &x4, x3);
    setobj(L,  &x2[0] , &x4);
    if (iscollectable(&x4) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table     */
    /* ------------------------ */
    StackValue* x5 = L->top;
    sethvalue(L, s2v(x5), x1); x5++;
    L->top = x5;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "sum");
    setobj(L, s2v(L->top), &x2[0]); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

