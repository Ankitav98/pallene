/* This file was generated by the Titan compiler. Do not edit by hand */
/* Indentation and formatting courtesy of titan-compiler/pretty.lua */

#include <string.h>

#include "tcore.h"

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "lstring.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

static Table * function_matmul_titan(
    lua_State * L,
    Table * x1 /* A */,
    Table * x2 /* B */
){
    lua_checkstack(L, 3);
    CClosure * x3 = clCvalue(s2v(L->ci->func));
    Table * x4 /* upvalue table */ = hvalue(&x3->upvalue[0]);
    TValue * x5 /* upvalue array */ = x4->array;
    (void)x5;
    {
        luaC_condGC(L, {
            StackValue* x6 = L->top;
            sethvalue(L, s2v(x6), x1); x6++;
            sethvalue(L, s2v(x6), x2); x6++;
            L->top = x6;
        }, {
            L->top -= 2;
        });
        Table * x7 = luaH_new(L);
        luaH_resizearray(L, x7, 0);
        TValue * x8 = x7->array;
        (void) x8;
        Table * x9 /* C */ = x7;
        lua_Integer x10 = luaH_getn(x1);
        lua_Integer x11 /* NI */ = x10;
        lua_Integer x12 = luaH_getn(x2);
        lua_Integer x13 /* NK */ = x12;
        lua_Unsigned x14 /* ui */ = ((lua_Unsigned)1) - 1;
        const TValue * x15 /* arrslot */;
        if (TITAN_LIKELY(x14 < x2->sizearray)) {
            x15 = &x2->array[x14];
        } else {
            x15 = luaH_getint(x2, 1);
        }
        if (TITAN_UNLIKELY(!ttistable(x15))) {
            titan_runtime_array_type_error(L, 5, LUA_TTABLE, rawtt(x15));
        }
        Table * x16 = hvalue(x15);
        lua_Integer x17 = luaH_getn(x16);
        lua_Integer x18 /* NJ */ = x17;
        lua_Integer x19 /* start */ = 1;
        lua_Integer x20 /* finish */ = x11;
        lua_Integer x21 /* inc */ = 1;
        while ((x21 >= 0 ? x19 <= x20 : x19 >= x20)) {
            lua_Integer x22 /* i */ = x19;
            (void) x22;
            {
                luaC_condGC(L, {
                    StackValue* x23 = L->top;
                    sethvalue(L, s2v(x23), x1); x23++;
                    sethvalue(L, s2v(x23), x2); x23++;
                    sethvalue(L, s2v(x23), x9); x23++;
                    L->top = x23;
                }, {
                    L->top -= 3;
                });
                Table * x24 = luaH_new(L);
                luaH_resizearray(L, x24, 0);
                TValue * x25 = x24->array;
                (void) x25;
                Table * x26 /* line */ = x24;
                lua_Integer x27 /* start */ = 1;
                lua_Integer x28 /* finish */ = x18;
                lua_Integer x29 /* inc */ = 1;
                while ((x29 >= 0 ? x27 <= x28 : x27 >= x28)) {
                    lua_Integer x30 /* j */ = x27;
                    (void) x30;
                    {
                        lua_Unsigned x31 /* ui */ = ((lua_Unsigned)x30) - 1;
                        TValue * x32 /* slot */;
                        if (TITAN_LIKELY(x31 < x26->sizearray)) {
                            x32 = &x26->array[x31];
                        } else {
                            TValue x33;
                            setivalue(&x33, x31+1);
                            x32 = luaH_newkey(L, x26, &x33);
                        }
                        setfltvalue(x32, 0x0p+0 /*0.000000*/);
                    }
                    x27 = intop(+, x27, x29);
                }
                lua_Unsigned x34 /* ui */ = ((lua_Unsigned)x22) - 1;
                TValue * x35 /* slot */;
                if (TITAN_LIKELY(x34 < x9->sizearray)) {
                    x35 = &x9->array[x34];
                } else {
                    TValue x36;
                    setivalue(&x36, x34+1);
                    x35 = luaH_newkey(L, x9, &x36);
                }
                sethvalue(L, x35, x26);
                if (isblack(obj2gco(x9)) && iswhite(obj2gco(x26))) {
                    luaC_barrierback_(L, obj2gco(x9));
                }
            }
            x19 = intop(+, x19, x21);
        }
        lua_Integer x37 /* start */ = 1;
        lua_Integer x38 /* finish */ = x13;
        lua_Integer x39 /* inc */ = 1;
        while ((x39 >= 0 ? x37 <= x38 : x37 >= x38)) {
            lua_Integer x40 /* k */ = x37;
            (void) x40;
            {
                lua_Unsigned x41 /* ui */ = ((lua_Unsigned)x40) - 1;
                const TValue * x42 /* arrslot */;
                if (TITAN_LIKELY(x41 < x2->sizearray)) {
                    x42 = &x2->array[x41];
                } else {
                    x42 = luaH_getint(x2, x40);
                }
                if (TITAN_UNLIKELY(!ttistable(x42))) {
                    titan_runtime_array_type_error(L, 14, LUA_TTABLE, rawtt(x42));
                }
                Table * x43 = hvalue(x42);
                Table * x44 /* Bk */ = x43;
                lua_Integer x45 /* start */ = 1;
                lua_Integer x46 /* finish */ = x11;
                lua_Integer x47 /* inc */ = 1;
                while ((x47 >= 0 ? x45 <= x46 : x45 >= x46)) {
                    lua_Integer x48 /* i */ = x45;
                    (void) x48;
                    {
                        lua_Unsigned x49 /* ui */ = ((lua_Unsigned)x48) - 1;
                        const TValue * x50 /* arrslot */;
                        if (TITAN_LIKELY(x49 < x1->sizearray)) {
                            x50 = &x1->array[x49];
                        } else {
                            x50 = luaH_getint(x1, x48);
                        }
                        if (TITAN_UNLIKELY(!ttistable(x50))) {
                            titan_runtime_array_type_error(L, 16, LUA_TTABLE, rawtt(x50));
                        }
                        Table * x51 = hvalue(x50);
                        lua_Unsigned x52 /* ui */ = ((lua_Unsigned)x40) - 1;
                        const TValue * x53 /* arrslot */;
                        if (TITAN_LIKELY(x52 < x51->sizearray)) {
                            x53 = &x51->array[x52];
                        } else {
                            x53 = luaH_getint(x51, x40);
                        }
                        if (TITAN_UNLIKELY(!ttisfloat(x53))) {
                            titan_runtime_array_type_error(L, 16, LUA_TNUMFLT, rawtt(x53));
                        }
                        lua_Number x54 = fltvalue(x53);
                        lua_Number x55 /* Aik */ = x54;
                        lua_Unsigned x56 /* ui */ = ((lua_Unsigned)x48) - 1;
                        const TValue * x57 /* arrslot */;
                        if (TITAN_LIKELY(x56 < x9->sizearray)) {
                            x57 = &x9->array[x56];
                        } else {
                            x57 = luaH_getint(x9, x48);
                        }
                        if (TITAN_UNLIKELY(!ttistable(x57))) {
                            titan_runtime_array_type_error(L, 17, LUA_TTABLE, rawtt(x57));
                        }
                        Table * x58 = hvalue(x57);
                        Table * x59 /* Ci */ = x58;
                        lua_Integer x60 /* start */ = 1;
                        lua_Integer x61 /* finish */ = x18;
                        lua_Integer x62 /* inc */ = 1;
                        while ((x62 >= 0 ? x60 <= x61 : x60 >= x61)) {
                            lua_Integer x63 /* j */ = x60;
                            (void) x63;
                            {
                                lua_Unsigned x64 /* ui */ = ((lua_Unsigned)x63) - 1;
                                const TValue * x65 /* arrslot */;
                                if (TITAN_LIKELY(x64 < x59->sizearray)) {
                                    x65 = &x59->array[x64];
                                } else {
                                    x65 = luaH_getint(x59, x63);
                                }
                                if (TITAN_UNLIKELY(!ttisfloat(x65))) {
                                    titan_runtime_array_type_error(L, 19, LUA_TNUMFLT, rawtt(x65));
                                }
                                lua_Number x66 = fltvalue(x65);
                                lua_Unsigned x67 /* ui */ = ((lua_Unsigned)x63) - 1;
                                const TValue * x68 /* arrslot */;
                                if (TITAN_LIKELY(x67 < x44->sizearray)) {
                                    x68 = &x44->array[x67];
                                } else {
                                    x68 = luaH_getint(x44, x63);
                                }
                                if (TITAN_UNLIKELY(!ttisfloat(x68))) {
                                    titan_runtime_array_type_error(L, 19, LUA_TNUMFLT, rawtt(x68));
                                }
                                lua_Number x69 = fltvalue(x68);
                                lua_Number x70 = x55 * x69;
                                lua_Number x71 = x66 + x70;
                                lua_Unsigned x72 /* ui */ = ((lua_Unsigned)x63) - 1;
                                TValue * x73 /* slot */;
                                if (TITAN_LIKELY(x72 < x59->sizearray)) {
                                    x73 = &x59->array[x72];
                                } else {
                                    TValue x74;
                                    setivalue(&x74, x72+1);
                                    x73 = luaH_newkey(L, x59, &x74);
                                }
                                setfltvalue(x73, x71);
                            }
                            x60 = intop(+, x60, x62);
                        }
                    }
                    x45 = intop(+, x45, x47);
                }
            }
            x37 = intop(+, x37, x39);
        }
        return x9;
    }
}

static int function_matmul_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 2)) {
        titan_runtime_arity_error(L, 2, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttistable(x6))) {
        titan_runtime_argument_type_error(L, "A", 1, LUA_TTABLE, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttistable(x7))) {
        titan_runtime_argument_type_error(L, "B", 1, LUA_TTABLE, x7);
    }
    Table * x8 = hvalue(s2v(x4 + 1));
    Table * x9 = hvalue(s2v(x4 + 2));
    Table * x10 /* ret */ = function_matmul_titan(L, x8, x9);
    sethvalue(L, s2v(L->top), x10);
    api_incr_top(L);
    return 1;
}

int luaopen_benchmarks_matmul_hash(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Table * x1 = luaH_new(L);
    luaH_resizearray(L, x1, 3);
    TValue * x2 = x1->array;
    /* Initialize upvalues */
    /* ------------------- */
    TString * x3 = luaS_new(L, "__index");
    setsvalue(L,  &x2[0] , x3);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x3))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x4 = luaS_new(L, "__metatable");
    setsvalue(L,  &x2[1] , x4);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* matmul */
    CClosure* x5 = luaF_newCclosure(L, 1);
    x5->f = function_matmul_lua;
    sethvalue(L, &x5->upvalue[0], x1);
    TValue x6; setclCvalue(L, &x6, x5);
    setobj(L,  &x2[2] , &x6);
    if (iscollectable(&x6) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x6))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table */
    /* -------------------- */
    StackValue* x7 = L->top;
    sethvalue(L, s2v(x7), x1); x7++;
    L->top = x7;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "matmul");
    setobj(L, s2v(L->top),  &x2[2] ); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

