/* This file was generated by the Pallene compiler. Do not edit by hand */
/* Indentation and formatting courtesy of pallene/pretty.lua */

#include <string.h>

#include "pallene_core.h"

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "lstring.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

static Table * function_matmul_pallene(
    lua_State * L,
    Table * x1 /* A */,
    Table * x2 /* B */
){
    lua_checkstack(L, 3);
    CClosure * x3 = clCvalue(s2v(L->ci->func));
    Udata * x4 /* upvalue table */ = uvalue(&x3->upvalue[0]);
    UValue * x5 /* upvalue array */ = x4->uv;
    (void)x5;
    {
        luaC_condGC(L, {
            StackValue* x6 = L->top;
            sethvalue(L, s2v(x6), x1); x6++;
            sethvalue(L, s2v(x6), x2); x6++;
            L->top = x6;
        }, {
            L->top -= 2;
        });
        Table * x7 = luaH_new(L);
        luaH_resizearray(L, x7, 0);
        TValue * x8 = x7->array;
        (void) x8;
        Table * x9 /* C */ = x7;
        lua_Integer x10 = luaH_getn(x1);
        lua_Integer x11 /* NI */ = x10;
        lua_Integer x12 = luaH_getn(x2);
        lua_Integer x13 /* NK */ = x12;
        lua_Unsigned x14 /* ui */ = ((lua_Unsigned)1) - 1;
        if (PALLENE_UNLIKELY(x14 >= x2->sizearray)) {
            pallene_renormalize_array(L, x2, x14, 5);
        }
        const TValue * x15 /* arrslot */ = &x2->array[x14];
        Table * x16 = hvalue(x15);
        lua_Integer x17 = luaH_getn(x16);
        lua_Integer x18 /* NJ */ = x17;
        lua_Integer x19 /* start */ = 1;
        lua_Integer x20 /* limit */ = x11;
        lua_Integer x21 /* step */ = 1;
        while ((x21 >= 0 ? x19 <= x20 : x19 >= x20)) {
            lua_Integer x22 /* i */ = x19;
            (void) x22;
            {
                luaC_condGC(L, {
                    StackValue* x23 = L->top;
                    sethvalue(L, s2v(x23), x1); x23++;
                    sethvalue(L, s2v(x23), x2); x23++;
                    sethvalue(L, s2v(x23), x9); x23++;
                    L->top = x23;
                }, {
                    L->top -= 3;
                });
                Table * x24 = luaH_new(L);
                luaH_resizearray(L, x24, 0);
                TValue * x25 = x24->array;
                (void) x25;
                Table * x26 /* line */ = x24;
                lua_Integer x27 /* start */ = 1;
                lua_Integer x28 /* limit */ = x18;
                lua_Integer x29 /* step */ = 1;
                while ((x29 >= 0 ? x27 <= x28 : x27 >= x28)) {
                    lua_Integer x30 /* j */ = x27;
                    (void) x30;
                    {
                        lua_Unsigned x31 /* ui */ = ((lua_Unsigned)x30) - 1;
                        if (PALLENE_UNLIKELY(x31 >= x26->sizearray)) {
                            pallene_renormalize_array(L, x26, x31, 9);
                        }
                        TValue * x32 /* slot */ = &x26->array[x31];
                        setfltvalue(x32, 0x0p+0 /*0.000000*/);
                    }
                    x27 = intop(+, x27, x29);
                }
                lua_Unsigned x33 /* ui */ = ((lua_Unsigned)x22) - 1;
                if (PALLENE_UNLIKELY(x33 >= x9->sizearray)) {
                    pallene_renormalize_array(L, x9, x33, 11);
                }
                TValue * x34 /* slot */ = &x9->array[x33];
                sethvalue(L, x34, x26);
                if (isblack(obj2gco(x9)) && iswhite(obj2gco(x26))) {
                    luaC_barrierback_(L, obj2gco(x9));
                }
            }
            x19 = intop(+, x19, x21);
        }
        lua_Integer x35 /* start */ = 1;
        lua_Integer x36 /* limit */ = x13;
        lua_Integer x37 /* step */ = 1;
        while ((x37 >= 0 ? x35 <= x36 : x35 >= x36)) {
            lua_Integer x38 /* k */ = x35;
            (void) x38;
            {
                lua_Unsigned x39 /* ui */ = ((lua_Unsigned)x38) - 1;
                if (PALLENE_UNLIKELY(x39 >= x2->sizearray)) {
                    pallene_renormalize_array(L, x2, x39, 14);
                }
                const TValue * x40 /* arrslot */ = &x2->array[x39];
                Table * x41 = hvalue(x40);
                Table * x42 /* Bk */ = x41;
                lua_Integer x43 /* start */ = 1;
                lua_Integer x44 /* limit */ = x11;
                lua_Integer x45 /* step */ = 1;
                while ((x45 >= 0 ? x43 <= x44 : x43 >= x44)) {
                    lua_Integer x46 /* i */ = x43;
                    (void) x46;
                    {
                        lua_Unsigned x47 /* ui */ = ((lua_Unsigned)x46) - 1;
                        if (PALLENE_UNLIKELY(x47 >= x1->sizearray)) {
                            pallene_renormalize_array(L, x1, x47, 16);
                        }
                        const TValue * x48 /* arrslot */ = &x1->array[x47];
                        Table * x49 = hvalue(x48);
                        lua_Unsigned x50 /* ui */ = ((lua_Unsigned)x38) - 1;
                        if (PALLENE_UNLIKELY(x50 >= x49->sizearray)) {
                            pallene_renormalize_array(L, x49, x50, 16);
                        }
                        const TValue * x51 /* arrslot */ = &x49->array[x50];
                        lua_Number x52 = fltvalue(x51);
                        lua_Number x53 /* Aik */ = x52;
                        lua_Unsigned x54 /* ui */ = ((lua_Unsigned)x46) - 1;
                        if (PALLENE_UNLIKELY(x54 >= x9->sizearray)) {
                            pallene_renormalize_array(L, x9, x54, 17);
                        }
                        const TValue * x55 /* arrslot */ = &x9->array[x54];
                        Table * x56 = hvalue(x55);
                        Table * x57 /* Ci */ = x56;
                        lua_Integer x58 /* start */ = 1;
                        lua_Integer x59 /* limit */ = x18;
                        lua_Integer x60 /* step */ = 1;
                        while ((x60 >= 0 ? x58 <= x59 : x58 >= x59)) {
                            lua_Integer x61 /* j */ = x58;
                            (void) x61;
                            {
                                lua_Unsigned x62 /* ui */ = ((lua_Unsigned)x61) - 1;
                                if (PALLENE_UNLIKELY(x62 >= x57->sizearray)) {
                                    pallene_renormalize_array(L, x57, x62, 19);
                                }
                                const TValue * x63 /* arrslot */ = &x57->array[x62];
                                lua_Number x64 = fltvalue(x63);
                                lua_Unsigned x65 /* ui */ = ((lua_Unsigned)x61) - 1;
                                if (PALLENE_UNLIKELY(x65 >= x42->sizearray)) {
                                    pallene_renormalize_array(L, x42, x65, 19);
                                }
                                const TValue * x66 /* arrslot */ = &x42->array[x65];
                                lua_Number x67 = fltvalue(x66);
                                lua_Number x68 = x53 * x67;
                                lua_Number x69 = x64 + x68;
                                lua_Unsigned x70 /* ui */ = ((lua_Unsigned)x61) - 1;
                                if (PALLENE_UNLIKELY(x70 >= x57->sizearray)) {
                                    pallene_renormalize_array(L, x57, x70, 19);
                                }
                                TValue * x71 /* slot */ = &x57->array[x70];
                                setfltvalue(x71, x69);
                            }
                            x58 = intop(+, x58, x60);
                        }
                    }
                    x43 = intop(+, x43, x45);
                }
            }
            x35 = intop(+, x35, x37);
        }
        return x9;
    }
}

static int function_matmul_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Udata * x2 /* upvalue table */ = uvalue(&x1->upvalue[0]);
    UValue * x3 /* upvalue array */ = x2->uv;
    (void)x3;
    StackValue* x4 = L->ci->func;
    Table * x8 = hvalue(s2v(x4 + 1));
    Table * x9 = hvalue(s2v(x4 + 2));
    Table * x10 /* ret */ = function_matmul_pallene(L, x8, x9);
    sethvalue(L, s2v(L->top), x10);
    api_incr_top(L);
    return 1;
}

int luaopen_benchmarks_matmul_nocheck(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Udata * x1 = luaS_newudata(L, 0, 4);
    UValue * x2 = x1->uv;
    /* Initialize upvalues */
    /* ------------------- */
    TString * x3 = luaS_new(L, "__index");
    setsvalue(L,  &x2[0].uv , x3);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x3))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x4 = luaS_new(L, "__newindex");
    setsvalue(L,  &x2[1].uv , x4);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x5 = luaS_new(L, "__metatable");
    setsvalue(L,  &x2[2].uv , x5);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x5))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* matmul */
    CClosure* x6 = luaF_newCclosure(L, 1);
    x6->f = function_matmul_lua;
    setuvalue(L, &x6->upvalue[0], x1);
    TValue x7; setclCvalue(L, &x7, x6);
    setobj(L,  &x2[3].uv , &x7);
    if (iscollectable(&x7) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x7))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table */
    /* -------------------- */
    StackValue* x8 = L->top;
    setuvalue(L, s2v(x8), x1); x8++;
    L->top = x8;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "matmul");
    setobj(L, s2v(L->top),  &x2[3].uv ); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

