/* This file was generated by the Titan compiler. Do not edit by hand */
/* Indentation and formatting courtesy of titan-compiler/pretty.lua */

#include <string.h>

#include "tcore.h"

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "lstring.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

static int function_isplaceok_titan(
    lua_State * L,
    Table * x1 /* a */,
    lua_Integer x2 /* n */,
    lua_Integer x3 /* c */
){
    CClosure * x4 = clCvalue(s2v(L->ci->func));
    Table * x5 /* upvalue table */ = hvalue(&x4->upvalue[0]);
    TValue * x6 /* upvalue array */ = x5->array;
    (void)x6;
    {
        lua_Integer x8 = intop(-, x2, 1);
        lua_Integer x7 /* start */ = 1;
        lua_Integer x9 /* finish */ = x8;
        lua_Integer x10 /* inc */ = 1;
        while ((x10 >= 0 ? x7 <= x9 : x7 >= x9)) {
            lua_Integer x11 /* i */ = x7;
            (void) x11;
            {
                lua_Unsigned x12 /* ui */ = ((lua_Unsigned)x11) - 1;
                const TValue * x13 /* arrslot */;
                if (TITAN_LIKELY(x12 < x1->sizearray)) {
                    x13 = &x1->array[x12];
                } else {
                    x13 = luaH_getint(x1, x11);
                }
                if (TITAN_UNLIKELY(!ttisinteger(x13))) {
                    titan_runtime_array_type_error(L, 4, LUA_TNUMINT, rawtt(x13));
                }
                lua_Integer x14 = ivalue(x13);
                lua_Integer x15 /* d */ = x14;
                {
                    int x16 = x15 == x3;
                    int x17 = x16;
                    if (!x17) {
                        lua_Integer x18 = intop(-, x15, x11);
                        lua_Integer x19 = intop(-, x3, x2);
                        int x20 = x18 == x19;
                        x17 = x20;
                    }
                    int x21 = x17;
                    if (!x21) {
                        lua_Integer x22 = intop(+, x15, x11);
                        lua_Integer x23 = intop(+, x3, x2);
                        int x24 = x22 == x23;
                        x21 = x24;
                    }
                    if (x21) {
                        return 0;
                    }
                }
            }
            x7 = intop(+, x7, x10);
        }
        return 1;
    }
}

static int function_isplaceok_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 3)) {
        titan_runtime_arity_error(L, 3, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttistable(x6))) {
        titan_runtime_argument_type_error(L, "a", 2, LUA_TTABLE, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttisinteger(x7))) {
        titan_runtime_argument_type_error(L, "n", 2, LUA_TNUMINT, x7);
    }
    TValue* x8 = s2v(x4 + 3);
    if (TITAN_UNLIKELY(!ttisinteger(x8))) {
        titan_runtime_argument_type_error(L, "c", 2, LUA_TNUMINT, x8);
    }
    Table * x9 = hvalue(s2v(x4 + 1));
    lua_Integer x10 = ivalue(s2v(x4 + 2));
    lua_Integer x11 = ivalue(s2v(x4 + 3));
    int x12 /* ret */ = function_isplaceok_titan(L, x9, x10, x11);
    setbvalue(s2v(L->top), x12);
    api_incr_top(L);
    return 1;
}

static void function_printsolution_titan(
    lua_State * L,
    lua_Integer x1 /* N */,
    Table * x2 /* a */
){
    CClosure * x3 = clCvalue(s2v(L->ci->func));
    Table * x4 /* upvalue table */ = hvalue(&x3->upvalue[0]);
    TValue * x5 /* upvalue array */ = x4->array;
    (void)x5;
    {
        lua_Integer x6 /* start */ = 1;
        lua_Integer x7 /* finish */ = x1;
        lua_Integer x8 /* inc */ = 1;
        while ((x8 >= 0 ? x6 <= x7 : x6 >= x7)) {
            lua_Integer x9 /* i */ = x6;
            (void) x9;
            {
                lua_Unsigned x10 /* ui */ = ((lua_Unsigned)x9) - 1;
                const TValue * x11 /* arrslot */;
                if (TITAN_LIKELY(x10 < x2->sizearray)) {
                    x11 = &x2->array[x10];
                } else {
                    x11 = luaH_getint(x2, x9);
                }
                if (TITAN_UNLIKELY(!ttisinteger(x11))) {
                    titan_runtime_array_type_error(L, 18, LUA_TNUMINT, rawtt(x11));
                }
                lua_Integer x12 = ivalue(x11);
                lua_Integer x13 /* ai */ = x12;
                lua_Integer x14 /* start */ = 1;
                lua_Integer x15 /* finish */ = x1;
                lua_Integer x16 /* inc */ = 1;
                while ((x16 >= 0 ? x14 <= x15 : x14 >= x15)) {
                    lua_Integer x17 /* j */ = x14;
                    (void) x17;
                    {
                        {
                            int x23 = x13 == x17;
                            if (x23) {
                                TValue * x24 =  &x5[2] ;
                                TString * x25 = tsvalue(x24);
                                FILE * x26 = stdout; /* TODO: use Lua output file */
                                const char * x27 = getstr(x25);
                                size_t x28 = tsslen(x25);
                                fwrite(x27, sizeof(char), x28, x26);
                            } else {
                                TValue * x18 =  &x5[3] ;
                                TString * x19 = tsvalue(x18);
                                FILE * x20 = stdout; /* TODO: use Lua output file */
                                const char * x21 = getstr(x19);
                                size_t x22 = tsslen(x19);
                                fwrite(x21, sizeof(char), x22, x20);
                            }
                        }
                        TValue * x29 =  &x5[4] ;
                        TString * x30 = tsvalue(x29);
                        FILE * x31 = stdout; /* TODO: use Lua output file */
                        const char * x32 = getstr(x30);
                        size_t x33 = tsslen(x30);
                        fwrite(x32, sizeof(char), x33, x31);
                    }
                    x14 = intop(+, x14, x16);
                }
                TValue * x34 =  &x5[6] ;
                TString * x35 = tsvalue(x34);
                FILE * x36 = stdout; /* TODO: use Lua output file */
                const char * x37 = getstr(x35);
                size_t x38 = tsslen(x35);
                fwrite(x37, sizeof(char), x38, x36);
            }
            x6 = intop(+, x6, x8);
        }
        TValue * x39 =  &x5[6] ;
        TString * x40 = tsvalue(x39);
        FILE * x41 = stdout; /* TODO: use Lua output file */
        const char * x42 = getstr(x40);
        size_t x43 = tsslen(x40);
        fwrite(x42, sizeof(char), x43, x41);
    }
}

static int function_printsolution_lua(lua_State *L)
{
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 2)) {
        titan_runtime_arity_error(L, 2, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttisinteger(x6))) {
        titan_runtime_argument_type_error(L, "N", 16, LUA_TNUMINT, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttistable(x7))) {
        titan_runtime_argument_type_error(L, "a", 16, LUA_TTABLE, x7);
    }
    lua_Integer x8 = ivalue(s2v(x4 + 1));
    Table * x9 = hvalue(s2v(x4 + 2));
    function_printsolution_titan(L, x8, x9);
    return 0;
}

static void function_addqueen_titan(
    lua_State * L,
    lua_Integer x1 /* N */,
    Table * x2 /* a */,
    lua_Integer x3 /* n */
){
    lua_checkstack(L, 1);
    CClosure * x4 = clCvalue(s2v(L->ci->func));
    Table * x5 /* upvalue table */ = hvalue(&x4->upvalue[0]);
    TValue * x6 /* upvalue array */ = x5->array;
    (void)x6;
    {
        {
            int x18 = x3 > x1;
            if (x18) {
                StackValue* x19 = L->top;
                sethvalue(L, s2v(x19), x2); x19++;
                L->top = x19;
                function_printsolution_titan(L, x1, x2);
                L->top -= 1;
            } else {
                lua_Integer x7 /* start */ = 1;
                lua_Integer x8 /* finish */ = x1;
                lua_Integer x9 /* inc */ = 1;
                while ((x9 >= 0 ? x7 <= x8 : x7 >= x8)) {
                    lua_Integer x10 /* c */ = x7;
                    (void) x10;
                    {
                        {
                            StackValue* x11 = L->top;
                            sethvalue(L, s2v(x11), x2); x11++;
                            L->top = x11;
                            int x12 = function_isplaceok_titan(L, x2, x3, x10);
                            L->top -= 1;
                            if (x12) {
                                lua_Unsigned x13 /* ui */ = ((lua_Unsigned)x3) - 1;
                                TValue * x14 /* slot */;
                                if (TITAN_LIKELY(x13 < x2->sizearray)) {
                                    x14 = &x2->array[x13];
                                } else {
                                    TValue x15;
                                    setivalue(&x15, x13+1);
                                    x14 = luaH_newkey(L, x2, &x15);
                                }
                                setivalue(x14, x10);
                                lua_Integer x16 = intop(+, x3, 1);
                                StackValue* x17 = L->top;
                                sethvalue(L, s2v(x17), x2); x17++;
                                L->top = x17;
                                function_addqueen_titan(L, x1, x2, x16);
                                L->top -= 1;
                            }
                        }
                    }
                    x7 = intop(+, x7, x9);
                }
            }
        }
    }
}

static int function_addqueen_lua(lua_State *L)
{
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 3)) {
        titan_runtime_arity_error(L, 3, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttisinteger(x6))) {
        titan_runtime_argument_type_error(L, "N", 34, LUA_TNUMINT, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttistable(x7))) {
        titan_runtime_argument_type_error(L, "a", 34, LUA_TTABLE, x7);
    }
    TValue* x8 = s2v(x4 + 3);
    if (TITAN_UNLIKELY(!ttisinteger(x8))) {
        titan_runtime_argument_type_error(L, "n", 34, LUA_TNUMINT, x8);
    }
    lua_Integer x9 = ivalue(s2v(x4 + 1));
    Table * x10 = hvalue(s2v(x4 + 2));
    lua_Integer x11 = ivalue(s2v(x4 + 3));
    function_addqueen_titan(L, x9, x10, x11);
    return 0;
}

static void function_nqueens_titan(
    lua_State * L,
    lua_Integer x1 /* N */
){
    lua_checkstack(L, 1);
    CClosure * x2 = clCvalue(s2v(L->ci->func));
    Table * x3 /* upvalue table */ = hvalue(&x2->upvalue[0]);
    TValue * x4 /* upvalue array */ = x3->array;
    (void)x4;
    {
        luaC_condGC(L, {
        }, {
        });
        Table * x5 = luaH_new(L);
        luaH_resizearray(L, x5, 0);
        TValue * x6 = x5->array;
        (void) x6;
        StackValue* x7 = L->top;
        sethvalue(L, s2v(x7), x5); x7++;
        L->top = x7;
        function_addqueen_titan(L, x1, x5, 1);
        L->top -= 1;
    }
}

static int function_nqueens_lua(lua_State *L)
{
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 1)) {
        titan_runtime_arity_error(L, 1, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttisinteger(x6))) {
        titan_runtime_argument_type_error(L, "N", 48, LUA_TNUMINT, x6);
    }
    lua_Integer x7 = ivalue(s2v(x4 + 1));
    function_nqueens_titan(L, x7);
    return 0;
}

int luaopen_benchmarks_queen_hash(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Table * x1 = luaH_new(L);
    luaH_resizearray(L, x1, 11);
    TValue * x2 = x1->array;
    /* Initialize upvalues */
    /* ------------------- */
    TString * x3 = luaS_new(L, "__index");
    setsvalue(L,  &x2[0] , x3);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x3))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x4 = luaS_new(L, "__metatable");
    setsvalue(L,  &x2[1] , x4);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x5 = luaS_new(L, "X");
    setsvalue(L,  &x2[2] , x5);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x5))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x6 = luaS_new(L, "-");
    setsvalue(L,  &x2[3] , x6);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x6))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x7 = luaS_new(L, " ");
    setsvalue(L,  &x2[4] , x7);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x7))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x8 = luaS_new(L, "\n");
    setsvalue(L,  &x2[5] , x8);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x8))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x9 = luaS_new(L, "\n");
    setsvalue(L,  &x2[6] , x9);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x9))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* isplaceok */
    CClosure* x10 = luaF_newCclosure(L, 1);
    x10->f = function_isplaceok_lua;
    sethvalue(L, &x10->upvalue[0], x1);
    TValue x11; setclCvalue(L, &x11, x10);
    setobj(L,  &x2[7] , &x11);
    if (iscollectable(&x11) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x11))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* printsolution */
    CClosure* x12 = luaF_newCclosure(L, 1);
    x12->f = function_printsolution_lua;
    sethvalue(L, &x12->upvalue[0], x1);
    TValue x13; setclCvalue(L, &x13, x12);
    setobj(L,  &x2[8] , &x13);
    if (iscollectable(&x13) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x13))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* addqueen */
    CClosure* x14 = luaF_newCclosure(L, 1);
    x14->f = function_addqueen_lua;
    sethvalue(L, &x14->upvalue[0], x1);
    TValue x15; setclCvalue(L, &x15, x14);
    setobj(L,  &x2[9] , &x15);
    if (iscollectable(&x15) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x15))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* nqueens */
    CClosure* x16 = luaF_newCclosure(L, 1);
    x16->f = function_nqueens_lua;
    sethvalue(L, &x16->upvalue[0], x1);
    TValue x17; setclCvalue(L, &x17, x16);
    setobj(L,  &x2[10] , &x17);
    if (iscollectable(&x17) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x17))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table */
    /* -------------------- */
    StackValue* x18 = L->top;
    sethvalue(L, s2v(x18), x1); x18++;
    L->top = x18;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "nqueens");
    setobj(L, s2v(L->top),  &x2[10] ); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

