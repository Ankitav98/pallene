/* This file was generated by the Titan compiler. Do not edit by hand */
/* Indentation and formatting courtesy of titan-compiler/pretty.lua */

#include <string.h>

#include "tcore.h"

#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

#include "lapi.h"
#include "lfunc.h"
#include "lgc.h"
#include "lobject.h"
#include "lstate.h"
#include "lstring.h"
#include "ltable.h"
#include "lvm.h"

#include "math.h"

static lua_Number function_matmul_titan(
    lua_State * L,
    Table * x1 /* A */,
    Table * x2 /* B */
){
    CClosure * x3 = clCvalue(s2v(L->ci->func));
    Table * x4 /* upvalue table */ = hvalue(&x3->upvalue[0]);
    TValue * x5 /* upvalue array */ = x4->array;
    (void)x5;
    {
        lua_Number x6 /* s */ = 0x0p+0 /*0.000000*/;
        lua_Integer x7 = luaH_getn(x1);
        lua_Integer x8 /* NI */ = x7;
        lua_Integer x9 = luaH_getn(x2);
        lua_Integer x10 /* NK */ = x9;
        lua_Unsigned x11 /* ui */ = ((lua_Unsigned)1) - 1;
        const TValue * x12 /* arrslot */;
        if (TITAN_LIKELY(x11 < x2->sizearray)) {
            x12 = &x2->array[x11];
        } else {
            x12 = luaH_getint(x2, 1);
        }
        if (TITAN_UNLIKELY(!ttistable(x12))) {
            titan_runtime_array_type_error(L, 5, LUA_TTABLE, rawtt(x12));
        }
        Table * x13 = hvalue(x12);
        lua_Integer x14 = luaH_getn(x13);
        lua_Integer x15 /* NJ */ = x14;
        lua_Integer x16 /* start */ = 1;
        lua_Integer x17 /* finish */ = x10;
        lua_Integer x18 /* inc */ = 1;
        while ((x18 >= 0 ? x16 <= x17 : x16 >= x17)) {
            lua_Integer x19 /* k */ = x16;
            (void) x19;
            {
                lua_Unsigned x20 /* ui */ = ((lua_Unsigned)x19) - 1;
                const TValue * x21 /* arrslot */;
                if (TITAN_LIKELY(x20 < x2->sizearray)) {
                    x21 = &x2->array[x20];
                } else {
                    x21 = luaH_getint(x2, x19);
                }
                if (TITAN_UNLIKELY(!ttistable(x21))) {
                    titan_runtime_array_type_error(L, 7, LUA_TTABLE, rawtt(x21));
                }
                Table * x22 = hvalue(x21);
                Table * x23 /* Bk */ = x22;
                lua_Integer x24 /* start */ = 1;
                lua_Integer x25 /* finish */ = x8;
                lua_Integer x26 /* inc */ = 1;
                while ((x26 >= 0 ? x24 <= x25 : x24 >= x25)) {
                    lua_Integer x27 /* i */ = x24;
                    (void) x27;
                    {
                        lua_Unsigned x28 /* ui */ = ((lua_Unsigned)x27) - 1;
                        const TValue * x29 /* arrslot */;
                        if (TITAN_LIKELY(x28 < x1->sizearray)) {
                            x29 = &x1->array[x28];
                        } else {
                            x29 = luaH_getint(x1, x27);
                        }
                        if (TITAN_UNLIKELY(!ttistable(x29))) {
                            titan_runtime_array_type_error(L, 9, LUA_TTABLE, rawtt(x29));
                        }
                        Table * x30 = hvalue(x29);
                        lua_Unsigned x31 /* ui */ = ((lua_Unsigned)x19) - 1;
                        const TValue * x32 /* arrslot */;
                        if (TITAN_LIKELY(x31 < x30->sizearray)) {
                            x32 = &x30->array[x31];
                        } else {
                            x32 = luaH_getint(x30, x19);
                        }
                        if (TITAN_UNLIKELY(!ttisfloat(x32))) {
                            titan_runtime_array_type_error(L, 9, LUA_TNUMFLT, rawtt(x32));
                        }
                        lua_Number x33 = fltvalue(x32);
                        lua_Number x34 /* Aik */ = x33;
                        lua_Integer x35 /* start */ = 1;
                        lua_Integer x36 /* finish */ = x15;
                        lua_Integer x37 /* inc */ = 1;
                        while ((x37 >= 0 ? x35 <= x36 : x35 >= x36)) {
                            lua_Integer x38 /* j */ = x35;
                            (void) x38;
                            {
                                lua_Unsigned x39 /* ui */ = ((lua_Unsigned)x38) - 1;
                                const TValue * x40 /* arrslot */;
                                if (TITAN_LIKELY(x39 < x23->sizearray)) {
                                    x40 = &x23->array[x39];
                                } else {
                                    x40 = luaH_getint(x23, x38);
                                }
                                if (TITAN_UNLIKELY(!ttisfloat(x40))) {
                                    titan_runtime_array_type_error(L, 11, LUA_TNUMFLT, rawtt(x40));
                                }
                                lua_Number x41 = fltvalue(x40);
                                lua_Number x42 = x34 * x41;
                                lua_Number x43 = x6 + x42;
                                x6 = x43;
                            }
                            x35 = intop(+, x35, x37);
                        }
                    }
                    x24 = intop(+, x24, x26);
                }
            }
            x16 = intop(+, x16, x18);
        }
        return x6;
    }
}

static int function_matmul_lua(lua_State *L)
{
    lua_checkstack(L, 1);
    CClosure * x1 = clCvalue(s2v(L->ci->func));
    Table * x2 /* upvalue table */ = hvalue(&x1->upvalue[0]);
    TValue * x3 /* upvalue array */ = x2->array;
    (void)x3;
    StackValue* x4 = L->ci->func;
    int x5 /* nargs */ = cast_int(L->top - (x4 + 1));
    if (TITAN_UNLIKELY(x5 != 2)) {
        titan_runtime_arity_error(L, 2, x5);
    }
    TValue* x6 = s2v(x4 + 1);
    if (TITAN_UNLIKELY(!ttistable(x6))) {
        titan_runtime_argument_type_error(L, "A", 1, LUA_TTABLE, x6);
    }
    TValue* x7 = s2v(x4 + 2);
    if (TITAN_UNLIKELY(!ttistable(x7))) {
        titan_runtime_argument_type_error(L, "B", 1, LUA_TTABLE, x7);
    }
    Table * x8 = hvalue(s2v(x4 + 1));
    Table * x9 = hvalue(s2v(x4 + 2));
    lua_Number x10 /* ret */ = function_matmul_titan(L, x8, x9);
    setfltvalue(s2v(L->top), x10);
    api_incr_top(L);
    return 1;
}

int luaopen_benchmarks_matmulsum_hash(lua_State *L)
{
    lua_checkstack(L, 4);
    /* Allocate upvalue table */
    /* ---------------------- */
    Table * x1 = luaH_new(L);
    luaH_resizearray(L, x1, 3);
    TValue * x2 = x1->array;
    /* Initialize upvalues */
    /* ------------------- */
    TString * x3 = luaS_new(L, "__index");
    setsvalue(L,  &x2[0] , x3);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x3))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    TString * x4 = luaS_new(L, "__metatable");
    setsvalue(L,  &x2[1] , x4);
    if (isblack(obj2gco(x1)) && iswhite(obj2gco(x4))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* matmul */
    CClosure* x5 = luaF_newCclosure(L, 1);
    x5->f = function_matmul_lua;
    sethvalue(L, &x5->upvalue[0], x1);
    TValue x6; setclCvalue(L, &x6, x5);
    setobj(L,  &x2[2] , &x6);
    if (iscollectable(&x6) && isblack(obj2gco(x1)) && iswhite(gcvalue(&x6))) {
        luaC_barrierback_(L, obj2gco(x1));
    }
    /* Create exports table */
    /* -------------------- */
    StackValue* x7 = L->top;
    sethvalue(L, s2v(x7), x1); x7++;
    L->top = x7;
    lua_createtable(L, 0, 1);
    lua_pushstring(L, "matmul");
    setobj(L, s2v(L->top),  &x2[2] ); api_incr_top(L);
    lua_settable(L, -3);
    return 1;
}

